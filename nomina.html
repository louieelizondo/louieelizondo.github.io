<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>NÃ³mina â€” Natural Balance</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&family=IBM+Plex+Sans:wght@300;400;600&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #f5f0e8;
      --surface: #ffffff;
      --border: #e0d8cc;
      --text: #1a1714;
      --muted: #8a8278;
      --accent: #1a6b3c;
      --accent-light: #e8f5ee;
      --danger: #c0392b;
      --mono: 'IBM Plex Mono', monospace;
      --sans: 'IBM Plex Sans', sans-serif;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: var(--sans);
      font-weight: 300;
      min-height: 100vh;
      padding: 2rem;
    }

    header {
      max-width: 900px;
      margin: 0 auto 2.5rem;
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      border-bottom: 2px solid var(--text);
      padding-bottom: 1rem;
    }

    .logo {
      font-family: var(--mono);
      font-weight: 600;
      font-size: 1rem;
      letter-spacing: -0.02em;
    }

    .logo span { color: var(--accent); }

    .header-right {
      font-family: var(--mono);
      font-size: 0.75rem;
      color: var(--muted);
    }

    h1 {
      font-family: var(--mono);
      font-weight: 600;
      font-size: clamp(1.5rem, 3vw, 2rem);
      letter-spacing: -0.03em;
      margin-bottom: 0.25rem;
    }

    .subtitle {
      font-size: 0.85rem;
      color: var(--muted);
      margin-bottom: 2rem;
    }

    .main { max-width: 900px; margin: 0 auto; }

    /* EMPLOYEE INPUTS */
    .employees-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .employee-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.25rem;
      position: relative;
      transition: border-color 0.15s;
    }

    .employee-card:focus-within { border-color: var(--accent); }

    .employee-num {
      font-family: var(--mono);
      font-size: 0.7rem;
      color: var(--muted);
      letter-spacing: 0.1em;
      text-transform: uppercase;
      margin-bottom: 0.75rem;
    }

    .input-group { position: relative; }

    .input-group label {
      display: block;
      font-size: 0.75rem;
      color: var(--muted);
      margin-bottom: 0.3rem;
    }

    .input-row {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 0.6rem;
    }

    .input-row input {
      flex: 1;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.5rem 0.75rem;
      font-family: var(--mono);
      font-size: 0.9rem;
      color: var(--text);
      outline: none;
      transition: border-color 0.15s;
      width: 100%;
    }

    .input-row input:focus { border-color: var(--accent); }
    .input-row input::placeholder { color: var(--muted); }

    .name-input {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.5rem 0.75rem;
      font-family: var(--sans);
      font-size: 0.85rem;
      color: var(--text);
      outline: none;
      width: 100%;
      transition: border-color 0.15s;
      margin-bottom: 0.6rem;
    }

    .name-input:focus { border-color: var(--accent); }
    .name-input::placeholder { color: var(--muted); }

    .currency-badge {
      background: var(--accent-light);
      color: var(--accent);
      font-family: var(--mono);
      font-size: 0.8rem;
      font-weight: 600;
      padding: 0.5rem 0.6rem;
      border-radius: 4px;
      border: 1px solid rgba(26,107,60,0.2);
      white-space: nowrap;
    }

    /* ACTIONS */
    .actions {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 2.5rem;
      flex-wrap: wrap;
    }

    .btn {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 600;
      padding: 0.7rem 1.4rem;
      border-radius: 4px;
      border: none;
      cursor: pointer;
      transition: all 0.15s;
      letter-spacing: 0.02em;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover { background: #155c33; transform: translateY(-1px); }

    .btn-ghost {
      background: transparent;
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-ghost:hover { border-color: var(--text); }

    .btn-danger {
      background: transparent;
      color: var(--danger);
      border: 1px solid rgba(192,57,43,0.3);
    }

    .btn-danger:hover { background: rgba(192,57,43,0.05); }

    /* RESULTS */
    #results { display: none; }

    .results-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      margin-bottom: 1.5rem;
      padding-bottom: 0.75rem;
      border-bottom: 1px solid var(--border);
    }

    .results-header h2 {
      font-family: var(--mono);
      font-size: 1.1rem;
      font-weight: 600;
    }

    .total-badge {
      font-family: var(--mono);
      font-size: 1.1rem;
      font-weight: 600;
      color: var(--accent);
    }

    /* INDIVIDUAL BREAKDOWN */
    .breakdowns {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .breakdown-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      animation: fadeUp 0.4s ease both;
    }

    .breakdown-header {
      background: var(--text);
      color: white;
      padding: 0.8rem 1.1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .breakdown-name {
      font-family: var(--mono);
      font-size: 0.85rem;
      font-weight: 600;
    }

    .breakdown-amount {
      font-family: var(--mono);
      font-size: 0.9rem;
      color: #c8f060;
    }

    .breakdown-table {
      width: 100%;
      border-collapse: collapse;
    }

    .breakdown-table tr {
      border-bottom: 1px solid var(--border);
    }

    .breakdown-table tr:last-child { border-bottom: none; }

    .breakdown-table td {
      padding: 0.5rem 1.1rem;
      font-family: var(--mono);
      font-size: 0.82rem;
    }

    .breakdown-table td:first-child { color: var(--muted); }
    .breakdown-table td:last-child { text-align: right; font-weight: 600; }

    .denomination-label {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .bill-tag {
      background: var(--accent-light);
      color: var(--accent);
      font-size: 0.65rem;
      padding: 0.1rem 0.3rem;
      border-radius: 2px;
      font-weight: 600;
    }

    .coin-tag {
      background: #fff8e6;
      color: #b8860b;
      font-size: 0.65rem;
      padding: 0.1rem 0.3rem;
      border-radius: 2px;
      font-weight: 600;
    }

    .zero-row td { opacity: 0.3; }

    /* SUMMARY TABLE */
    .summary-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 2rem;
    }

    .summary-table-wrap {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
    }

    .summary-title {
      background: var(--accent);
      color: white;
      padding: 0.9rem 1.25rem;
      font-family: var(--mono);
      font-size: 0.9rem;
      font-weight: 600;
      letter-spacing: 0.05em;
      text-transform: uppercase;
    }

    .summary-table {
      width: 100%;
      border-collapse: collapse;
    }

    .summary-table th {
      background: var(--bg);
      font-family: var(--mono);
      font-size: 0.72rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      padding: 0.65rem 1.25rem;
      text-align: left;
      border-bottom: 1px solid var(--border);
    }

    .summary-table th:not(:first-child) { text-align: right; }

    .summary-table td {
      font-family: var(--mono);
      font-size: 0.82rem;
      padding: 0.6rem 1.25rem;
      border-bottom: 1px solid var(--border);
    }

    .summary-table td:not(:first-child) { text-align: right; }

    .summary-table tr:last-child td { border-bottom: none; }

    .summary-table .total-row {
      background: var(--accent-light);
      font-weight: 600;
    }

    .summary-table .total-row td { color: var(--accent); }

    .check-section {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1.25rem;
      display: flex;
      align-items: center;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .check-section label {
      font-family: var(--mono);
      font-size: 0.8rem;
      color: var(--muted);
      white-space: nowrap;
    }

    .check-section input {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 4px;
      padding: 0.5rem 0.75rem;
      font-family: var(--mono);
      font-size: 0.9rem;
      color: var(--text);
      outline: none;
      width: 160px;
    }

    .check-section input:focus { border-color: var(--accent); }

    .diff-display {
      font-family: var(--mono);
      font-size: 0.9rem;
      font-weight: 600;
      padding: 0.5rem 1rem;
      border-radius: 4px;
      display: none;
    }

    .diff-ok { background: var(--accent-light); color: var(--accent); display: block; }
    .diff-warn { background: #fef0ee; color: var(--danger); display: block; }

    @keyframes fadeUp {
      from { opacity: 0; transform: translateY(12px); }
      to { opacity: 1; transform: translateY(0); }
    }

    @media print {
      body { background: white; padding: 1rem; }
      .actions, .employees-grid, header { display: none; }
      #results { display: block !important; }
    }

    @media (max-width: 600px) {
      body { padding: 1rem; }
      .actions { flex-direction: column; }
      .btn { text-align: center; }
    }
  </style>
</head>
<body>

<header>
  <div class="logo">natural<span>balance</span>.club</div>
  <div class="header-right" id="fecha"></div>
</header>

<div class="main">
  <h1>ðŸ’µ NÃ³mina Viernes</h1>
  <p class="subtitle">Ingresa los sueldos semanales de tus empleados</p>

  <div class="employees-grid" id="employeeGrid"></div>

  <div class="actions">
    <button class="btn btn-primary" onclick="calculate()">Calcular desglose â†’</button>
    <button class="btn btn-ghost" onclick="addEmployee()" id="addBtn">+ Agregar empleado</button>
    <button class="btn btn-danger" onclick="clearAll()">Limpiar todo</button>
    <button class="btn btn-ghost" onclick="window.print()">ðŸ–¨ Imprimir</button>
  </div>

  <div id="results">
    <div class="results-header">
      <h2>Desglose individual</h2>
      <div class="total-badge" id="grandTotalBadge"></div>
    </div>

    <div class="breakdowns" id="breakdowns"></div>

    <div class="summary-section">
      <div class="summary-title">ðŸ“Š Resumen total de billetes y monedas</div>
      <div class="summary-table-wrap">
        <table class="summary-table" id="summaryTable"></table>
      </div>
    </div>

    <div class="check-section">
      <label>Comparar con monto del cheque:</label>
      <div style="display:flex; align-items:center; gap:0.4rem;">
        <span style="font-family:var(--mono); font-size:0.85rem; color:var(--muted);">$</span>
        <input type="number" id="checkAmount" placeholder="0.00" oninput="compareCheck()" />
        <span style="font-family:var(--mono); font-size:0.85rem; color:var(--muted);">MXN</span>
      </div>
      <div class="diff-display" id="diffDisplay"></div>
    </div>
  </div>
</div>

<script>
  // Mexican denominations: bills then coins
  const DENOMS = [
    { value: 500,  label: '$500',   type: 'bill' },
    { value: 200,  label: '$200',   type: 'bill' },
    { value: 100,  label: '$100',   type: 'bill' },
    { value: 50,   label: '$50',    type: 'bill' },
    { value: 20,   label: '$20',    type: 'bill' },
    { value: 10,   label: '$10',    type: 'coin' },
    { value: 5,    label: '$5',     type: 'coin' },
    { value: 2,    label: '$2',     type: 'coin' },
    { value: 1,    label: '$1',     type: 'coin' },
    { value: 0.5,  label: '50Â¢',   type: 'coin' },
  ];

  let employeeCount = 1;
  let grandTotal = 0;

  // Set today's date
  const today = new Date();
  document.getElementById('fecha').textContent = today.toLocaleDateString('es-MX', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });

  function buildEmployeeCard(num) {
    return `
      <div class="employee-card" id="card-${num}">
        <div class="employee-num">Empleado ${num}</div>
        <input class="name-input" id="name-${num}" type="text" placeholder="Nombre (opcional)" />
        <div class="input-row">
          <input type="number" id="salary-${num}" placeholder="Salario semanal" min="0" step="0.50" />
          <div class="currency-badge">MXN</div>
        </div>
      </div>
    `;
  }

  function initGrid() {
    const grid = document.getElementById('employeeGrid');
    grid.innerHTML = '';
    for (let i = 1; i <= 3; i++) {
      grid.innerHTML += buildEmployeeCard(i);
    }
    employeeCount = 3;
    updateAddBtn();
  }

  function addEmployee() {
    if (employeeCount >= 6) return;
    employeeCount++;
    document.getElementById('employeeGrid').innerHTML += buildEmployeeCard(employeeCount);
    updateAddBtn();
  }

  function updateAddBtn() {
    const btn = document.getElementById('addBtn');
    if (employeeCount >= 6) {
      btn.disabled = true;
      btn.textContent = 'MÃ¡ximo 6 empleados';
      btn.style.opacity = '0.4';
    } else {
      btn.disabled = false;
      btn.textContent = `+ Agregar empleado (${employeeCount}/6)`;
      btn.style.opacity = '1';
    }
  }

  function breakdown(amount) {
    // Work in centavos to avoid float issues
    let remaining = Math.round(amount * 100);
    const result = [];
    for (const d of DENOMS) {
      const dCents = Math.round(d.value * 100);
      const count = Math.floor(remaining / dCents);
      result.push({ ...d, count });
      remaining -= count * dCents;
    }
    return result;
  }

  function formatMXN(n) {
    return new Intl.NumberFormat('es-MX', { style: 'currency', currency: 'MXN' }).format(n);
  }

  function calculate() {
    const employees = [];
    for (let i = 1; i <= employeeCount; i++) {
      const nameEl = document.getElementById(`name-${i}`);
      const salEl = document.getElementById(`salary-${i}`);
      if (!salEl) continue;
      const salary = parseFloat(salEl.value);
      if (!salary || salary <= 0) continue;
      const name = nameEl?.value?.trim() || `Empleado ${i}`;
      employees.push({ name, salary });
    }

    if (employees.length === 0) {
      alert('Ingresa al menos un salario para continuar.');
      return;
    }

    grandTotal = employees.reduce((s, e) => s + e.salary, 0);
    document.getElementById('grandTotalBadge').textContent = `Total: ${formatMXN(grandTotal)}`;

    // Individual breakdowns
    const bContainer = document.getElementById('breakdowns');
    bContainer.innerHTML = '';
    employees.forEach((emp, idx) => {
      const bd = breakdown(emp.salary);
      const rows = bd.map(d => {
        const tag = d.type === 'bill'
          ? `<span class="bill-tag">BILLETE</span>`
          : `<span class="coin-tag">MONEDA</span>`;
        const rowClass = d.count === 0 ? 'zero-row' : '';
        return `<tr class="${rowClass}">
          <td><div class="denomination-label">${tag} ${d.label}</div></td>
          <td>${d.count === 0 ? 'â€”' : `Ã— ${d.count}`}</td>
        </tr>`;
      }).join('');

      bContainer.innerHTML += `
        <div class="breakdown-card" style="animation-delay:${idx * 0.08}s">
          <div class="breakdown-header">
            <div class="breakdown-name">${emp.name}</div>
            <div class="breakdown-amount">${formatMXN(emp.salary)}</div>
          </div>
          <table class="breakdown-table">${rows}</table>
        </div>
      `;
    });

    // Summary table â€” total pieces per denomination
    const totals = DENOMS.map(d => ({ ...d, count: 0 }));
    employees.forEach(emp => {
      const bd = breakdown(emp.salary);
      bd.forEach((d, i) => { totals[i].count += d.count; });
    });

    const empHeaders = employees.map(e => `<th>${e.name}<br><span style="font-weight:300;color:var(--accent)">${formatMXN(e.salary)}</span></th>`).join('');
    let tableHTML = `<thead><tr><th>DenominaciÃ³n</th>${empHeaders}<th>Total piezas</th></tr></thead><tbody>`;

    totals.forEach((t, i) => {
      const tag = t.type === 'bill'
        ? `<span class="bill-tag">BILLETE</span>`
        : `<span class="coin-tag">MONEDA</span>`;
      const empCols = employees.map((emp, ei) => {
        const bd = breakdown(emp.salary);
        const cnt = bd[i].count;
        return `<td>${cnt === 0 ? 'â€”' : cnt}</td>`;
      }).join('');
      const rowClass = t.count === 0 ? 'zero-row' : '';
      tableHTML += `<tr class="${rowClass}"><td><div class="denomination-label">${tag} ${t.label}</div></td>${empCols}<td><strong>${t.count === 0 ? 'â€”' : t.count}</strong></td></tr>`;
    });

    // Total row
    const empTotals = employees.map(e => `<td><strong>${formatMXN(e.salary)}</strong></td>`).join('');
    tableHTML += `<tr class="total-row"><td>TOTAL</td>${empTotals}<td>${formatMXN(grandTotal)}</td></tr>`;
    tableHTML += '</tbody>';

    document.getElementById('summaryTable').innerHTML = tableHTML;
    document.getElementById('checkAmount').value = '';
    document.getElementById('diffDisplay').className = 'diff-display';

    const resultsEl = document.getElementById('results');
    resultsEl.style.display = 'block';
    resultsEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }

  function compareCheck() {
    const checkVal = parseFloat(document.getElementById('checkAmount').value);
    const display = document.getElementById('diffDisplay');
    if (!checkVal || grandTotal === 0) { display.className = 'diff-display'; return; }
    const diff = Math.round((checkVal - grandTotal) * 100) / 100;
    if (diff === 0) {
      display.textContent = 'âœ“ Cuadra exacto';
      display.className = 'diff-display diff-ok';
    } else if (diff > 0) {
      display.textContent = `+${formatMXN(diff)} de sobra`;
      display.className = 'diff-display diff-warn';
    } else {
      display.textContent = `${formatMXN(diff)} de diferencia`;
      display.className = 'diff-display diff-warn';
    }
  }

  function clearAll() {
    initGrid();
    document.getElementById('results').style.display = 'none';
    grandTotal = 0;
  }

  initGrid();
</script>
</body>
</html>
